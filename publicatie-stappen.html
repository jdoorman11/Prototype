<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wizard – Publicatiecontrole</title>
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    /* --- mobielvriendelijke basisopmaak --- */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 0 1rem; color: #212529; }
    header, footer { max-width: 720px; margin: 0 auto; padding: 1.5rem 0; text-align: center; }
    header h1 { margin: 0; font-size: 1.75rem; color: #005da9; }
    header p { margin: .25rem 0 1rem; font-size: 1rem; color: #555; }
    .wizard { max-width: 720px; margin: 0 auto 2rem auto; background: #fff; border: 1px solid #e1e4e8; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,.07); }
    .wizard-question { font-weight: 600; font-size: 1.2rem; margin: 0 0 1rem; color: #333; }
    .wizard-buttons { display: flex; flex-direction: column; gap: .75rem; }
    .wizard-buttons button {
        padding: .75rem 1.25rem; font-size: 1rem; border: 1px solid transparent; border-radius: 6px;
        color: #fff; font-weight: 600; cursor: pointer; transition: opacity .15s, background-color .15s;
        text-align: center;
    }
    .wizard-buttons button:hover { opacity: .9; }

    .btn-yes { background-color: #28a745; border-color: #28a745; }
    .btn-yes:hover { background-color: #218838; }
    .btn-no { background-color: #dc3545; border-color: #dc3545; }
    .btn-no:hover { background-color: #c82333; }
    .btn-neutral { background-color: #007bff; border-color: #007bff; }
    .btn-neutral:hover { background-color: #0069d9; }
    
    .summary { background: #eef2f6; padding: 1.25rem; border-radius: 6px; margin-top: 2rem; font-size: .95rem; line-height: 1.5; border-left: 4px solid #005da9; }
    .summary strong { display: block; margin-bottom: .5rem; font-size: 1.05rem; color: #005da9;}
    .summary ul { padding-left: 20px; margin: 0; }
    .summary li { margin-bottom: .25rem; }

    .metadata-info {
        background: #f9f9f9; padding: .75rem 1rem; border-radius: 4px; margin: 1rem 0 1.5rem 0;
        font-size: .9rem; line-height: 1.5; border-left: 3px solid #007bff;
    }
    .metadata-info p { margin: .5rem 0; }
    .metadata-info strong { color: #333; }
    .metadata-info em { color: #555; }

    .conclusion-text { font-size: 1.1rem; font-weight: 500; margin-bottom: 1rem; }
    .conclusion-section h2 { font-size: 1.4rem; color: #005da9; margin-bottom: .75rem; }

    /* Modal styles */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.6); display: flex;
        justify-content: center; align-items: center; z-index: 1000;
        opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-overlay.active { opacity: 1; visibility: visible; }
    .modal-content {
        background-color: white; padding: 25px 30px; border-radius: 8px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.25); text-align: left;
        min-width: 320px; max-width: 500px; width: 90%;
        transform: scale(0.95); transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal-content { transform: scale(1); }
    .modal-content h3 { margin-top: 0; font-size: 1.3rem; color: #333; }
    .modal-content p { margin-bottom: 1.5rem; font-size: 1rem; line-height: 1.5; color: #555;}
    .modal-content button { float: right; }
  </style>
</head>
<body>
  <!-- Universal header will be loaded here -->
  <header data-component="header"></header>
  <div class="container">

  <main class="wizard" id="wizardContainer" aria-live="polite">
    </main>

  <footer>
    Prototype wizard • Juni 2025
  </div>
  </div>

  <script src="/js/load-components.js"></script>
  <script>

  // Specifieke JSON data voor Publicatiecontrole
  const decisionTreesData = [
{
  "flowName": "Publicatiecontrole",
  "startNodeId": "P1",
  "nodes": [
    {
      "id": "P1",
      "type": "question",
      "text": "Brengt openbaarmaking de eenheid van de Kroon in gevaar?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "P2"
        }
      ],
      "metadata": {
        "waarom": "Beschermt de samenwerking tussen koning en ministers",
        "citaat": "de eenheid van de Kroon in gevaar zou kunnen brengen",
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub a",
        "toelichting": "Bijvoorbeeld vertrouwelijke communicatie tussen Koning en ministers."
      }
    },
    {
      "id": "P2",
      "type": "question",
      "text": "Kan openbaarmaking de veiligheid van de Staat schaden?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "P3"
        }
      ],
      "metadata": {
        "waarom": "Voorkomt gevaar voor Nederland",
        "citaat": "de veiligheid van de Staat zou kunnen schaden",
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub b",
        "toelichting": "Bijvoorbeeld militaire operaties, terrorismebestrijding."
      }
    },
    {
      "id": "P3",
      "type": "question",
      "text": "Bevat het document vertrouwelijke bedrijfs‑ of fabricagegegevens van derden?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "P4"
        }
      ],
      "metadata": {
        "waarom": "Voorkomt dat bedrijfsgeheimen uitlekken",
        "citaat": "bedrijfs- en fabricagegegevens ... vertrouwelijk meegedeeld",
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub c",
        "toelichting": "Denk aan geheime recepturen of aanbestedingsprijzen."
      }
    },
    {
      "id": "P4",
      "type": "question",
      "text": "Bevat het document bijzondere persoonsgegevens (UAVG §3.1 / §3.2)?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P4b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P5"
        }
      ],
      "metadata": {
        "waarom": "Beschermt iemands privacy",
        "citaat": "tenzij de betrokkene uitdrukkelijk toestemming heeft gegeven ... of kennelijk openbaar",
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub d",
        "toelichting": "Bijvoorbeeld gezondheidsgegevens, politieke opvattingen."
      }
    },
    {
      "id": "P4b",
      "type": "question",
      "text": "Is er toestemming gegeven of is de data geanonimiseerd?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P5"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_2"
        }
      ],
      "metadata": {
        "waarom": "Alleen met toestemming of na anonimiseren mogen bijzondere persoonsgegevens openbaar",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub d / AVG",
        "toelichting": "Bijzondere persoonsgegevens mogen niet openbaar zonder toestemming. Anonimiseren kan uitkomst bieden."
      }
    },
    {
      "id": "P5",
      "type": "question",
      "text": "Bevat het document wettelijk voorgeschreven identificatienummers (bijv. BSN)?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P5b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P6"
        }
      ],
      "metadata": {
        "waarom": "Voorkomt dat iemands privégegevens openbaar worden",
        "citaat": "tenzij de verstrekking kennelijk geen inbreuk op de levenssfeer maakt",
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub e",
        "toelichting": "Bijvoorbeeld studentnummers, kentekens – alleen delen als privacy niet wordt geschaad."
      }
    },
    {
      "id": "P5b",
      "type": "question",
      "text": "Is het mogelijk de identificerende gegevens te anonimiseren?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P6"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_3"
        }
      ],
      "metadata": {
        "waarom": "Anonimiseren voorkomt inbreuk op privacy",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub e",
        "toelichting": "Als identificerende gegevens verwijderd kunnen worden, kan het document openbaar."
      }
    },
    {
      "id": "P6",
      "type": "question",
      "text": "Is het document verkregen bij strafrechtelijke handhaving/toezicht én bestaat er een specifieke geheimhoudingsplicht?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P6b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P7"
        }
      ],
      "metadata": {
        "waarom": "Een andere wet verbiedt openbaarmaking",
        "citaat": "informatie verkregen ... waarvoor een specifieke wettelijke regeling geldt",
        "artikelOfRichtlijn": "Art. 5.1 lid 2",
        "toelichting": "Bijvoorbeeld politiegegevens, fiscale inlichtingen."
      }
    },
    {
      "id": "P6b",
      "type": "question",
      "text": "Bevat het document vertrouwelijke beleidsinformatie?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_4"
        }
      ],
      "metadata": {
        "waarom": "Vertrouwelijke beleidsinformatie mag worden geweigerd",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub f",
        "toelichting": "Denk aan informatie over intern beraad of beleidsvorming."
      }
    },
    {
      "id": "P7",
      "type": "question",
      "text": "Moet de geadresseerde de informatie eerst ontvangen (recht op voorinzage)?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P7b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P8"
        }
      ],
      "metadata": {
        "waarom": "Betrokkene mag eerst het document zien",
        "citaat": "belang ... om als eerste kennis te nemen",
        "artikelOfRichtlijn": "Art. 5.1 lid 4",
        "toelichting": "Bijvoorbeeld rapport dat eerst aan betrokken bedrijf wordt gestuurd."
      }
    },
    {
      "id": "P7b",
      "type": "question",
      "text": "Kan de schade voor derden worden voorkomen door anonimisering?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P8"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_5"
        }
      ],
      "metadata": {
        "waarom": "Beschermt belangen van derden",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 2 sub a",
        "toelichting": "Onevenredige schade voor derden kan reden zijn om openbaarmaking te weigeren, tenzij anonimisering helpt."
      }
    },
    {
      "id": "P8",
      "type": "question",
      "text": "Leidt openbaarmaking tot onevenredige benadeling van een ander belang dan lid 1/2?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P8b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P9"
        }
      ],
      "metadata": {
        "waarom": "Er zou uitzonderlijk grote schade ontstaan",
        "citaat": "onevenredige benadeling ... niet genoemd in het eerste of tweede lid",
        "artikelOfRichtlijn": "Art. 5.1 lid 5",
        "toelichting": "Alleen gebruiken bij uitzonderlijke, zwaarwegende belangen."
      }
    },
    {
      "id": "P8b",
      "type": "question",
      "text": "Kan het bestuursorgaan worden beschermd via gedeeltelijke openbaarmaking?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P9"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_6"
        }
      ],
      "metadata": {
        "waarom": "Beperkt de schade voor bestuursorganen",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.2 lid 1 sub b",
        "toelichting": "Soms kan een deel van de informatie openbaar, zonder schade aan de overheid."
      }
    },
    {
      "id": "P9",
      "type": "question",
      "text": "Bevat het milieu‑informatie met bedrijfsgeheimen en is de schade bij openbaarmaking ernstig?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P9b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P10"
        }
      ],
      "metadata": {
        "waarom": "Voorkomt dat bedrijfsgeheim over milieu‑stof uitlekt",
        "citaat": "voor zover ... ernstig geschaad wordt en belang openbaarheid niet opweegt",
        "artikelOfRichtlijn": "Art. 5.1 lid 6",
        "toelichting": "Bijvoorbeeld exacte samenstelling giftig product."
      }
    },
    {
      "id": "P9b",
      "type": "question",
      "text": "Is het risico op belemmering van opsporing te beperken door weglatingen?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P10"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_7"
        }
      ],
      "metadata": {
        "waarom": "Beschermt lopende onderzoeken",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub g",
        "toelichting": "Sommige info kan achterwege blijven om opsporing niet te hinderen."
      }
    },
    {
      "id": "P10",
      "type": "question",
      "text": "Gaat de informatie over emissies in het milieu?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_8"
        },
        {
          "text": "Nee",
          "nextNodeId": "P11"
        }
      ],
      "metadata": {
        "waarom": "Uitstootgegevens moeten altijd openbaar zijn",
        "citaat": "Het eerste en tweede lid zijn niet van toepassing ... emissies in het milieu",
        "artikelOfRichtlijn": "Art. 5.1 lid 7",
        "toelichting": "CO2-uitstoot, lozingen in water/grond – mag niet op lid 1/2 worden geweigerd."
      }
    },
    {
      "id": "P11",
      "type": "question",
      "text": "Bevat het document persoonlijke beleidsopvattingen voor intern beraad?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "P12"
        }
      ],
      "metadata": {
        "waarom": "Ambtenaren moeten vrij kunnen overleggen",
        "citaat": "geen informatie ... over daarin opgenomen persoonlijke beleidsopvattingen",
        "artikelOfRichtlijn": "Art. 5.2 lid 1",
        "toelichting": "Meningen, adviezen, overwegingen worden afgeschermd."
      }
    },
    {
      "id": "P12",
      "type": "question",
      "text": "Kunnen persoonlijke beleidsopvattingen geanonimiseerd worden verstrekt?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "P13"
        }
      ],
      "metadata": {
        "waarom": "Helpt burgers controleren wat de overheid doet",
        "citaat": "informatie ... in niet tot personen herleidbare vorm",
        "artikelOfRichtlijn": "Art. 5.2 lid 2",
        "toelichting": "Naam en functie weglaten; inhoud tonen."
      }
    },
    {
      "id": "P13",
      "type": "question",
      "text": "Heeft de auteur ingestemd met herkenbare openbaarmaking?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P14"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_9"
        }
      ],
      "metadata": {
        "waarom": "De persoon heeft zelf toestemming gegeven",
        "citaat": "Indien ... heeft ingestemd",
        "artikelOfRichtlijn": "Art. 5.2 lid 2",
        "toelichting": "Soms wil een expert bij naam genoemd worden."
      }
    },
    {
      "id": "P14",
      "type": "question",
      "text": "Is het document opgesteld voor formele besluitvorming door bestuurders (minister, burgemeester, GS, etc.)?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P14b"
        },
        {
          "text": "Nee",
          "nextNodeId": "P15"
        }
      ],
      "metadata": {
        "waarom": "Democratische controle op bestuurders",
        "citaat": "informatie ... tenzij het kunnen voeren van intern beraad onevenredig wordt geschaad",
        "artikelOfRichtlijn": "Art. 5.2 lid 3",
        "toelichting": "Toets of publicatie intern overleg ernstig hindert."
      }
    },
    {
      "id": "P14b",
      "type": "question",
      "text": "Bevat het persoonlijke beleidsopvattingen?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P14c"
        },
        {
          "text": "Nee",
          "nextNodeId": "P15"
        }
      ],
      "metadata": {
        "waarom": "Bedrijfsgeheimen mogen worden beschermd, maar publicatie is soms mogelijk met aanpassing",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub c",
        "toelichting": "Gevoelige info kan vaak weggelaten worden om toch openbaar te maken"
      }
    },
    {
      "id": "P14c",
      "type": "question",
      "text": "Beschaden deze persoonlijke beleidsopvattingen intern beraad?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_1"
        },
        {
          "text": "Nee",
          "nextNodeId": "P15"
        }
      ],
      "metadata": {
        "waarom": "Bedrijfsgeheimen mogen worden beschermd, maar publicatie is soms mogelijk met aanpassing",
        "citaat": null,
        "artikelOfRichtlijn": "Art. 5.1 lid 1 sub c",
        "toelichting": "Gevoelige info kan vaak weggelaten worden om toch openbaar te maken"
      }
    },
    {
      "id": "P15",
      "type": "question",
      "text": "Bevat het document persoonlijke beleidsopvattingen over milieu‑informatie?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "P15b"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_8"
        }
      ],
      "metadata": {
        "waarom": "Openheid over milieu weegt zwaarder",
        "citaat": "belang ... afgewogen tegen het belang van openbaarmaking",
        "artikelOfRichtlijn": "Art. 5.2 lid 4",
        "toelichting": "Milieukwesties krijgen voorkeur voor openbaarheid."
      }
    },
    {
      "id": "P15b",
      "type": "question",
      "text": "Heeft de auteur ingestemd met herkenbare publicatie van deze milieu‑opvatting?",
      "answers": [
        {
          "text": "Ja",
          "nextNodeId": "CONCL_8"
        },
        {
          "text": "Nee",
          "nextNodeId": "CONCL_10"
        }
      ],
      "metadata": {
        "waarom": "De persoon heeft zelf toestemming gegeven",
        "citaat": "Indien ... heeft ingestemd",
        "artikelOfRichtlijn": "Art. 5.2 lid 4",
        "toelichting": "Bijvoorbeeld wetenschapper wil bij naam genoemd worden."
      }
    },
    {
      "id": "CONCL_1",
      "type": "conclusion",
      "text": "Niet openbaar",
      "metadata": {}
    },
    {
      "id": "CONCL_2",
      "type": "conclusion",
      "text": "Toestemming vragen of data anonimiseren",
      "metadata": {}
    },
    {
      "id": "CONCL_3",
      "type": "conclusion",
      "text": "Beperk openbaarmaking tot niet-identificeerbare delen",
      "metadata": {}
    },
    {
      "id": "CONCL_4",
      "type": "conclusion",
      "text": "Beoordeel of delen openbaar kunnen",
      "metadata": {}
    },
    {
      "id": "CONCL_5",
      "type": "conclusion",
      "text": "Beoordeel mogelijkheid tot anonimisering",
      "metadata": {}
    },
    {
      "id": "CONCL_6",
      "type": "conclusion",
      "text": "Beoordeel of gedeeltelijke openbaarmaking mogelijk is",
      "metadata": {}
    },
    {
      "id": "CONCL_7",
      "type": "conclusion",
      "text": "Overweeg delen te schrappen om risico te beperken",
      "metadata": {}
    },
    {
      "id": "CONCL_8",
      "type": "conclusion",
      "text": "Openbaar",
      "metadata": {}
    },
    {
      "id": "CONCL_9",
      "type": "conclusion",
      "text": "Toestemming vragen",
      "metadata": {}
    },
    {
      "id": "CONCL_10",
      "type": "conclusion",
      "text": "Weeg openbaarheid af tegen privacybelang",
      "metadata": {}
    }
  ]
}
];


  // Globale variabelen voor de wizard-status
  let currentFlowName = null;
  let currentFlowData = null;
  let currentNodeId = null;
  let userAnswersHistory = []; 

  // DOM Elementen
  const wizardContainer = document.getElementById('wizardContainer');
  const mainHeader = document.querySelector('header h1');
  const mainParagraph = document.querySelector('header p');
  const docId = new URLSearchParams(location.search).get('id');

  function initializeWizard() {
    startFlow("Publicatiecontrole");
  }

  function startFlow(flowName) {
    currentFlowName = flowName;
    currentFlowData = decisionTreesData[0]; 

    if (!currentFlowData || currentFlowData.flowName !== flowName) {
      showModal('Fout', `De beslisboom "${flowName}" kon niet correct worden geladen.`);
      wizardContainer.innerHTML = `<p>Fout bij laden van beslisboom: ${flowName}</p>`;
      return;
    }

    currentNodeId = currentFlowData.startNodeId;
    userAnswersHistory = []; 
    if(mainHeader) mainHeader.textContent = `Wizard – ${currentFlowName}`;
    if(mainParagraph) mainParagraph.textContent = 'Beantwoord de onderstaande vragen om tot een conclusie te komen.';
    renderNode(currentNodeId);
  }

  function renderNode(nodeId) {
    const node = currentFlowData.nodes.find(n => n.id === nodeId);
    wizardContainer.innerHTML = ''; 

    if (!node) {
      showModal('Fout', `Ongeldige stap (ID: ${nodeId}) in de beslisboom "${currentFlowName}". Neem contact op met de beheerder.`);
      const errorMsg = createDOMElement('p', `Fout: Interne stap '${nodeId}' niet gevonden.`);
      const homeButton = createDOMElement('button', 'Terug naar overzicht', 'btn-neutral');
      homeButton.addEventListener('click', () => { window.location.href = 'index.html'; });
      wizardContainer.append(errorMsg, homeButton);
      return;
    }

    if (node.type === 'question') {
      renderQuestionNode(node);
    } else if (node.type === 'conclusion') {
      renderConclusionNode(node);
    }
  }

  function renderQuestionNode(node) {
    const questionElement = createDOMElement('p', node.text, 'wizard-question');
    wizardContainer.appendChild(questionElement);

    if (node.metadata && Object.keys(node.metadata).length > 0) {
      const metadataElement = createDOMElement('div', null, 'metadata-info');
      let html = '';
      if(node.metadata.toelichting) html += `<p><strong>Toelichting:</strong> ${node.metadata.toelichting}</p>`;
      if(node.metadata.waarom) html += `<p><strong>Waarom deze vraag:</strong> ${node.metadata.waarom}</p>`;
      if(node.metadata.citaat) html += `<p><strong>Relevant citaat:</strong> <em>${node.metadata.citaat}</em></p>`;
      if(node.metadata.artikelOfRichtlijn) html += `<p><strong>Zie ook:</strong> ${node.metadata.artikelOfRichtlijn}</p>`;
      metadataElement.innerHTML = html;
      wizardContainer.appendChild(metadataElement);
    }

    const buttonWrapper = createDOMElement('div', null, 'wizard-buttons');
    node.answers.forEach(answer => {
      let btnClass = 'btn-neutral';
      if (answer.text.toLowerCase() === 'ja') btnClass = 'btn-yes';
      else if (answer.text.toLowerCase() === 'nee') btnClass = 'btn-no';
      
      const buttonElement = createDOMElement('button', answer.text, btnClass);
      buttonElement.addEventListener('click', () => processAnswer(node.id, answer.text, answer.nextNodeId));
      buttonWrapper.appendChild(buttonElement);
    });
    wizardContainer.appendChild(buttonWrapper);
    
    const backToOverviewButton = createDOMElement('button', 'Terug naar overzicht', 'btn-neutral');
    backToOverviewButton.style.marginTop = '1rem'; 
    backToOverviewButton.style.backgroundColor = '#6c757d'; 
    backToOverviewButton.addEventListener('click', () => { window.location.href = 'index.html'; });
    wizardContainer.appendChild(backToOverviewButton);
  }

  function processAnswer(fromNodeId, answerText, nextNodeId) {
    const fromNode = currentFlowData.nodes.find(n => n.id === fromNodeId);
    userAnswersHistory.push({ question: fromNode.text, answer: answerText });
    currentNodeId = nextNodeId;
    renderNode(currentNodeId);
  }

  function renderConclusionNode(node) {
    const conclusionSection = createDOMElement('div', null, 'conclusion-section');
    const titleElement = createDOMElement('h2', 'Conclusie');
    conclusionSection.appendChild(titleElement);

    const textElement = createDOMElement('p', node.text, 'conclusion-text');
    conclusionSection.appendChild(textElement);

    if (node.metadata && Object.keys(node.metadata).length > 0) {
      const metadataElement = createDOMElement('div', null, 'metadata-info');
      let html = '';
      if(node.metadata.tag) html += `<p><strong>Voorgestelde Tag:</strong> ${node.metadata.tag}</p>`;
      if(node.metadata.toelichting) html += `<p><strong>Toelichting bij conclusie:</strong> ${node.metadata.toelichting}</p>`;
      if(node.metadata.waarom) html += `<p><strong>Reden voor conclusie:</strong> ${node.metadata.waarom}</p>`;
      if(node.metadata.citaat) html += `<p><strong>Relevant citaat:</strong> <em>${node.metadata.citaat}</em></p>`;
      if(node.metadata.artikelOfRichtlijn) html += `<p><strong>Zie ook:</strong> ${node.metadata.artikelOfRichtlijn}</p>`;
      metadataElement.innerHTML = html;
      conclusionSection.appendChild(metadataElement);
    }
    wizardContainer.appendChild(conclusionSection);

    if (userAnswersHistory.length > 0) {
      const summaryElement = createDOMElement('div', null, 'summary');
      let summaryHTML = '<strong>Uw antwoordenpad:</strong><ul>';
      userAnswersHistory.forEach(item => {
        const icon = item.answer.toLowerCase() === 'ja' ? '✔️' : (item.answer.toLowerCase() === 'nee' ? '❌' : '➡️');
        summaryHTML += `<li>${icon} ${item.question} &rarr; <strong>${item.answer}</strong></li>`;
      });
      summaryHTML += '</ul>';
      summaryElement.innerHTML = summaryHTML;
      wizardContainer.appendChild(summaryElement);
    }

    const buttonWrapper = createDOMElement('div', null, 'wizard-buttons');
    buttonWrapper.style.marginTop = '1.5rem';

    // Knop voor categorie toewijzen (indien relevant)
    // Voor Publicatiecontrole kan de tag "Document openbaar" zijn, of andere conclusies die geen directe tag hebben.
    const assignableTags = ["Document openbaar"]; 
    if (docId && node.metadata && node.metadata.tag && assignableTags.includes(node.metadata.tag)) {
      const assignButton = createDOMElement('button', `Status "${node.metadata.tag}" toewijzen`, 'btn-yes');
      assignButton.addEventListener('click', async () => {
        try {
          await assignCategoryAPI(docId, node.metadata.tag); // Gebruik de tag als categorie
          showModal('Succes!', `Status "${node.metadata.tag}" is succesvol toegewezen aan document ${docId}.`);
        } catch (error) {
          showModal('Fout bij toewijzen', `Er is een fout opgetreden: ${error.message}.`);
        }
      });
      buttonWrapper.appendChild(assignButton);
    }
    
    const restartCurrentFlowButton = createDOMElement('button', 'Start deze beslisboom opnieuw', 'btn-neutral');
    restartCurrentFlowButton.addEventListener('click', () => startFlow(currentFlowName));
    buttonWrapper.appendChild(restartCurrentFlowButton);

    const backToOverviewButton = createDOMElement('button', 'Terug naar overzicht', 'btn-neutral');
    backToOverviewButton.style.backgroundColor = '#6c757d';
    backToOverviewButton.addEventListener('click', () => { window.location.href = 'index.html'; });
    buttonWrapper.appendChild(backToOverviewButton);
    
    wizardContainer.appendChild(buttonWrapper);
  }

  function createDOMElement(tag, textContent, className) {
    const el = document.createElement(tag);
    if (textContent) el.textContent = textContent;
    if (className) el.className = className;
    return el;
  }

  async function assignCategoryAPI(documentId, category) {
    console.log(`API Call: Document ${documentId}, Categorie/Status ${category}`);
    return new Promise(resolve => setTimeout(() => {
        console.log(`Simulated API success for ${documentId} with category/status ${category}`);
        resolve({ success: true, message: "Categorie/Status toegewezen." });
    }, 1000));
  }

  function showModal(title, message) {
    let modalOverlay = document.getElementById('customModalOverlay');
    if (modalOverlay) modalOverlay.remove(); 

    modalOverlay = createDOMElement('div', null, 'modal-overlay');
    modalOverlay.id = 'customModalOverlay';

    const modalContent = createDOMElement('div', null, 'modal-content');
    const modalTitle = createDOMElement('h3', title);
    const modalMessage = createDOMElement('p', message);
    const closeButton = createDOMElement('button', 'Sluiten', 'btn-neutral');

    closeButton.onclick = () => {
      modalOverlay.classList.remove('active');
      setTimeout(() => modalOverlay.remove(), 300);
    };
    
    modalContent.append(modalTitle, modalMessage, closeButton);
    modalOverlay.appendChild(modalContent);
    document.body.appendChild(modalOverlay);

    void modalOverlay.offsetWidth;
    modalOverlay.classList.add('active');
  }

  document.addEventListener('DOMContentLoaded', initializeWizard);
</script>
</body>
</html>
